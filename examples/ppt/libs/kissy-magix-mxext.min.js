KISSY.add("magix/event",function(h,c){var d=c.safeExec;return{trigger:function(a,b,e,f){var c="~~"+a+"_list",g=this[c];if(g){b||(b={});if(!b.type)b.type=a;if(f)for(a=g.length-1;0<=a&&!(!1===d(g[a],b,this));a--);else{a=0;for(f=g.length;a<f&&!(!1===d(g[a],b,this));a++);}}e&&delete this[c]},bind:function(a,b){var e="~~"+a+"_list";this[e]||(this[e]=[]);this[e].push(b)},unbind:function(a,b){var e="~~"+a+"_list",f=this[e];if(f)if(b)for(var e=0,c=f.length;e<c;e++){if(f[e]==b){f.splice(e,1);break}}else delete this[e]}}},
{requires:["magix/magix"]});
KISSY.add("magix/impl/magix",function(h){return{libRequire:function(c,d){h.use(c,function(a,b){d(b)})},libEnv:function(){var c=this.config(),d=c.appHome;if(!d)throw Error("please set appHome");d=d.replace(/(^|\/)app\/?/i,function(b,e){return e||"./"});c.appHome=d;if(!c.release&&/^https?:\/\//.test(d))c.release=-1==d.indexOf(location.protocol+"//"+location.host);c.release||h.config({map:[[RegExp("("+d+".+)-min\\.js(\\?[^?]+)?"),"$1.js$2"]]});var a;(a=c.release?c.appTag:h.now())&&(a+=".js");h.config({packages:[{name:"app",
path:d,tag:a}]});c.viewChangeAnim&&h.use("mxext/vfanim")},isArray:h.isArray,isFunction:h.isFunction,isObject:h.isObject,isRegExp:h.isRegExp,isString:h.isString,isNumber:h.isNumber}});
KISSY.add("magix/impl/router",function(h){return{useHistoryState:function(){var c=this,d=location.href;h.one(window).on("popstate",function(){var a=location.href==d;if(c.$canFirePopState||!a)c.$canFirePopState=!0,c.route()})},useLocationHash:function(){var c=this;h.one(window).on("hashchange",function(){c.suspend();c.route();c.resume()})}}});
KISSY.add("magix/impl/view",function(h,c,d,a){var d=function(){},b={idIt:1,wrapAsyncUpdate:1,registerAsyncUpdateName:1,extend:1};d.extend=function(e,f){var c=function(){c.superclass.constructor.apply(this,arguments);f&&a.safeExec(f,[],this)},d;for(d in this)a.hasProp(b,d)&&(c[d]=this[d]);return h.extend(c,this,e)};a.mix(d.prototype,{getTmplByXHR:function(b,a){c({url:b,dataType:"html",success:function(b){a(b)},error:function(b,e){a(e)}})},delegateUnbubble:function(b,a){var c=this;if(!c.$cacheEvents)c.$cacheEvents=
{};b=h.one(b);b.delegate(a,"*[mx"+a+"]",c.$cacheEvents[a]=function(b){c.processEvent(b)})},undelegateUnbubble:function(b,a){var c=this.$cacheEvents;c&&(b=h.one(b),b.undelegate(a,"*[mx"+a+"]",c[a]),delete c[a])}});return d},{requires:["ajax","sizzle","magix/magix"]});
KISSY.add("magix/magix",function(h,c){var d=function(b,a){return!b?!1:Object.prototype.hasOwnProperty.call(b,a)},a=function(b,a,c){for(var e in a)if(d(a,e)&&(!c||!d(c,e)))b[e]=a[e];return b},b=function(b,a,c,d,j,o){e.isArray(b)||(b=[b]);if(!a||!e.isArray(a)&&!a.callee)a=[a];for(d=0;d<b.length;d++)try{o=b[d],j=e.isFunction(o)&&o.apply(c,a)}catch(q){h.log(q,o)}return j},e={mix:a,hasProp:d,safeExec:b,noop:function(){},templates:{},cfg:{},locals:{},config:function(b){var c=this.cfg;if(b)this.cfg=a(c,
b);return this.cfg},start:function(a){var c=this,a=c.config(a);c.libEnv();a.ready&&(b(a.ready),delete a.ready);c.libRequire("magix/router",function(b){c.libRequire("magix/vom",function(a){b.bind("locationChanged",function(b){b.changed.isViewPath()?a.remountRootVframe(b):a.notifyLocationChange(b)});b.bind("idle",function(){a.resume()});b.bind("busy",function(){a.suspend()});b.start()})})},objectKeys:function(b){if(Object.keys)return Object.keys(b);var a=[],c;for(c in b)d(b,c)&&a.push(c);return a},
local:function(b,a){var c=arguments,e=this.locals;if(0==c.length)return e;if(1==c.length)if(this.isObject(b))for(var j in b)d(b,j)&&(e[j]=b[j]);else return e[b];else e[b]=a}};return e.mix(e,c)},{requires:["magix/impl/magix"]});
KISSY.add("magix/router",function(h,c,d,a){var b=d.hasProp,e=function(a){return b(this.params,a)},f=function(){return b(this,k)},i=function(){return b(this,"viewPath")},g=function(){return this.hash[k]!=this.query[k]},l=function(b){return this.hash.params[b]!=this.query.params[b]},j=function(a){return b(this.hash.params,a)},o=function(a){return b(this.query.params,a)},q=function(b){return this.params[b]},r=d.safeExec,s=window,v=encodeURIComponent,w=decodeURIComponent,t=/\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,
x=/[^\/]*$/,u=/([#?]).*$/,n=/([^=&?\/#]+)=([^&=#?]*)/g,k="pathname",h=d.mix({iQ:[],iC:0,qH:{},compareObject:function(b,a){if(d.isObject(b)&&d.isObject(a)){for(var c=[],c=c.concat(d.objectKeys(b)),c=c.concat(d.objectKeys(a)),e=0;e<c.length;e++){var f=c[e];if(b[f]!=a[f])return!1}return!0}return b==a},getPathnameRelations:function(){if(this.$pnr)return this.$pnr;var a={virtualToReal:{},virtualRegExpToReal:{}},c=d.config().pathCfg,e=c.map,m=c.defaultView,f=c.defaultPathname||"";if(d.isObject(e))for(var j in e)if(b(e,
j))for(var l=j,g=e[j],i=[],i=d.isArray(g)?g:d.isString(g)?g.split(","):[g],g=0;g<i.length;g++)d.isRegExp(i[g])?a.virtualRegExpToReal[l]=i[g]:(!f&&l==m&&(f=i[g]),a.virtualToReal[i[g]]=l);if(!m)throw Error("unset defaultView");a.virtualToReal[""]=m;a.home=m;a[k]=f;a.notFound=c.notFound;return this.$pnr=a},getViewPath:function(b){var a=this.getPathnameRelations();b||(b=a[k]);var c=a.virtualToReal[b];if(!c)for(var e in a.virtualRegExpToReal)if(a.virtualRegExpToReal[e].test(b)){c=e;break}return{viewPath:c?
c:a.notFound||a.home,pathname:c?b:a.notFound?b:a[k]}},start:function(){this.supportHistoryState()?this.useHistoryState():this.useLocationHash();this.route()},supportHistoryState:function(){var b=s.history;return d.config().useHistoryState&&b.pushState&&b.replaceState},pathToObject:function(b){var a={},c={},e=s.location.protocol,f="";u.test(b)?f=b.replace(u,""):~b.indexOf("=")||(f=b);if(f)if(0==f.indexOf(e))e=f.indexOf("/",e.length+2),f=-1==e?"/":f.substring(e);else if("/"!=f.charAt(0)&&d.config().useHistoryState&&
!this.supportHistoryState()){e=s.location[k].replace(x,"");for(e+=f;t.test(e);)e=e.replace(t,"$1/");f=e}b.replace(n,function(b,a,e){c[a]=e});a[k]=f;a.params=c;return a},objectToPath:function(a){var c=a[k],e=[],d;for(d in a.params)b(a.params,d)&&e.push(d+"="+a.params[d]);return c+(e.length?"?":"")+e.join("&")},parseQueryAndHash:function(){var a=s.location.href,c=this.qH;try{a=w(a)}catch(e){}if(b(c,a))return c[a];var f=a.replace(/^[^?#]+/g,""),i=s.location[k]+f.replace(/^([^#]+).*$/g,"$1"),f=f.replace(/^[^#]*#?/g,
""),h=this.pathToObject(i),y=this.pathToObject(f.replace(/^!?/,"")),r={};d.mix(r,h.params);d.mix(r,y.params);return c[a]={isPathnameDiff:g,isParamDiff:l,hashParamsOwn:j,queryParamsOwn:o,get:q,originalQuery:i,originalHash:f,query:h,hash:y,params:r}},parseLocation:function(){var b=this.parseQueryAndHash(),a=this.getViewPath(d.config().useHistoryState?b.hash[k]?b.hash[k]:b.query[k]:b.hash[k]);return d.mix(b,a)},getChangedLocation:function(b,a){var c={params:{}};b[k]!=a[k]&&(c[k]=!0);if(b.viewPath!=a.viewPath)c.viewPath=
!0;for(var m=d.objectKeys(b.params),m=m.concat(d.objectKeys(a.params)),j=0;j<m.length;j++){var g=m[j];b.params[g]!=a.params[g]&&(c.params[g]=!0)}c.isParam=e;c.isPathname=f;c.isViewPath=i;return c},route:function(){var b=this.parseLocation(),a=this.$location||{params:{}},c=!this.$location,e;b.viewPath==(a.viewPath||"")?this.compareLocation(a,b)||(e=!0):e=!0;e&&(a=this.getChangedLocation(a,b),this.trigger("locationChanged",{location:b,changed:a,firstFire:c}));this.$location=b;this.resume()},compareLocation:function(b,
a){return b[k]!=a[k]?!1:this.compareObject(b.params,a.params)},navigate2:function(a){var c=this;a&&d.isString(a)&&c.idle(function(){c.trigger("busy");c.suspend();var e=c.pathToObject(a),f=d.mix({},c.$location.params),f=d.mix(f,e.params);if(e[k]){if(d.config().useHistoryState&&!c.supportHistoryState()&&(f=c.$location.query)&&(f=f.params))for(var j in f)b(f,j)&&!b(e.params,j)&&(e.params[j]="")}else e.params=f,e[k]=c.$location[k];c.compareLocation(e,c.$location)?c.resume():(e=c.objectToPath(e),c.supportHistoryState()?
(c.$canFirePopState=!0,history.pushState(new Date,document.title,e),c.route()):location.hash="#!"+e)})},navigate:function(b,a){if(d.isObject(b)){var c=[],e;for(e in b)c.push(e+"="+v(b[e]));b=c.join("&");a&&(b=a+"?"+b)}this.navigate2(b)},idle:function(b){this.iC?this.iQ.push(b):r(b)},suspend:function(){this.iC++},resume:function(){0<this.iC&&(this.iC--,this.iC||(this.trigger("idle"),this.iQ.length&&this.idle(this.iQ.shift())))}},a);return d.mix(h,c)},{requires:["magix/impl/router","magix/magix","magix/event"]});
KISSY.add("magix/vframe",function(h,c,d){var a=document,b=0,e=c.safeExec,f=function(b){return"object"==typeof b?b:a.getElementById(b)},i=function(b){this.rC=0;this.rM={};this.notifyParentAlter();var a=this.view;e(a.trigger,"childrenAlter",a);this.unloadSubVframes(b)},g=function(b){this.id=g.idIt(b);this.viewId=this.id+"_view";this.children=[];this.view=null;this.rC=0;this.rM={}};c.mix(g,{tagName:"vframe",idIt:function(a){return a.id||(a.id="magix_vf_"+b++)},createVframe:function(b,a){var b=f(b),e=
new g(b);c.mix(e,a);return e},createVframeNode:function(b,c){var e=a.createElement(g.tagName);e.id=b;c.parentNode.insertBefore(e,c)}});a.createElement(g.tagName);c.mix(g.prototype,d);c.mix(g.prototype,{viewChangeUseAnim:function(){return!1},oldViewDestroy:c.noop,prepareNextView:c.noop,newViewCreated:c.noop,mountView:function(b){var a=this,e=a.viewName&&a.viewChangeUseAnim();a.unmountView(e,!0);if(b)a.viewName=b,c.libRequire(b,function(c){if(b==a.viewName){c.wrapAsyncUpdate();var d;e?(d=a.viewId,a.prepareNextView()):
d=a.id;var f=new c({viewName:b,owner:a,ownerVOM:a.owner,id:d,vId:a.viewId,vfId:a.id});f.bind("interact",function(b){a.trigger("viewLoad",{view:f},a.vced=!0);e&&a.newViewCreated(!0);b.tmpl||a.loadSubVframes();f.bind("rendered",function(){a.loadSubVframes()});f.bind("prerender",function(b){i.call(a,b.anim)})});a.view=f;f.load()}})},unmountView:function(b,a){this.view?(i.call(this,b),this.view.destroy(b),this.vced=!1,b&&a&&this.oldViewDestroy(),delete this.view,delete this.viewName):this.viewName&&(this.unbind("viewLoad"),
delete this.viewName)},loadSubVframes:function(){this.owner.suspend();var b=(f(this.viewId)||f(this.id)).getElementsByTagName(g.tagName),a=b.length;if(a)for(var c=0,e;c<a;c++)e=b[c],e=g.createVframe(e,{owner:this.owner,parentId:this.id}),this.children.push(e.id),this.owner.registerVframe(e),e.mountView(b[c].getAttribute("data-view"));else this.notifyChildrenCreated();this.owner.resume()},unloadSubVframes:function(b){for(var a=this.children,c,e=0,d=a.length,g;e<d;e++)g=a[e],c=this.owner.getVframe(g),
c.unmountView(b),this.owner.unregisterVframe(c),f(g).id="";this.children=[]},postMessageTo:function(b,a){var d=this.owner;c.isArray(b)||(b=[b]);a||(a={});for(var f=0;f<b.length;f++){var g=d.getVframe(b[f]);if(g){var i=g.view;i&&g.vced?e(i.receiveMessage,a,i):g.viewName&&g.bind("viewLoad",function(b){e(b.view.receiveMessage,a,b.view)})}}},notifyLocationChange:function(b){var a=this.view;if(a&&a.exist&&a.rendered){if(e(a.testOLChanged,b,a))var f=e(a.locationChange,b,a);if(!1!==f){if(!c.isArray(f))f=
this.children;for(var a=0,d=f.length,g;a<d;a++)(g=this.owner.getVframe(f[a]))&&e(g.notifyLocationChange,b,g)}}},notifyChildrenCreated:function(){var b=this.view;b&&e(b.trigger,"childrenCreated",b);this.notifyParentAlter(!0)},notifyParentAlter:function(b){var a=this.parentId;if(a)if(a=this.owner.getVframe(a),b)c.hasProp(a.rM,this.id)||(a.rM[this.id]=1,a.rC++,a.rC==a.children.length&&a.notifyChildrenCreated());else if(c.hasProp(a.rM,this.id))delete a.rM[this.id],a.rC--,b=a.view,e(b.trigger,"childrenAlter",
b),a.notifyParentAlter()}});return g},{requires:["magix/magix","magix/event"]});
KISSY.add("magix/view",function(h,c,d,a){var b=1,e=d.safeExec,f=d.hasProp,i="render,renderUI,updateUI".split(","),g=function(b){d.mix(this,b);this.exist=!0;this.iQ=[];this.sign=this.iC=0},l=g.prototype,j=function(b,a){return function(){var c=this,e=arguments;c.idle(function(){a&&c.sign++;b.apply(c,e)})}},o=/(?:^|\s)return(?:(?:\s+[+\-\w$'"{\[\(\/])|[+\-{\[\(\/'"])/,q=/{([\s\S]+)}/,r=/\\[\s\S]/g,s=/\s*\/\s*/g,v=/^[\s\xa0\u3000\uFEFF]*$/,w=[/[^\w$_]\/[\s\S]*?\//,/(?:'[^']*')|(?:"[^"]*")/,/{[^{}]+}/],
t=function(b){if(b=(""+b).match(q)){b=b[1];if(v.test(b))return!0;for(var b=b.replace(r,"").replace(s,""),a=0,c;a<w.length;a++)for(c=w[a];c.test(b);)b=b.replace(c,"");return o.test(b)}return!1};d.mix(g,{idIt:function(a){return a.id||(a.id="magix_mxe_"+b++)},wrapAsyncUpdate:function(){if(!this["~~"]){this["~~"]=1;var b=this.prototype,a;this.registerAsyncUpdateName();for(var c in b){a=b[c];var e=null;d.isFunction(a)&&a!=d.noop&&!a["~~"]&&!t(a)&&(f(this.$ans,c)?e=j(a,!0):f(b,c)&&!f(l,c)&&(e=j(a)),e&&
(e["~~"]=a,b[c]=e))}}},registerAsyncUpdateName:function(b){if(!this.$ans){this.$ans={};for(var a=0;a<i.length;a++)this.$ans[i[a]]=!0}if(b){d.isArray(b)||(b=[b]);for(a=0;a<b.length;a++)this.$ans[b[a]]=!0}return this}});var x={submit:1,blur:1,focus:1,focusin:1,focusout:1,mouseenter:1,mouseleave:1,mousewheel:1,valuechange:1},h=g.prototype,u=document,n=window,k="abort,stop,cancel,destroy,dispose".split(","),p=function(b){return"object"==typeof b?b:u.getElementById(b)};d.mix(h,a);d.mix(h,{render:d.noop,
locationChange:d.noop,receiveMessage:d.noop,init:d.noop,hasTemplate:!0,enableEvent:!0,enableRefreshAnim:!1,load:function(){var b=this,a=b.hasTemplate,c=function(){b.suspend();e(b.render,[],b);b.delegateBubbleEvents();b.idle(function(){var c=!a&&!b.rendered;if(c)b.delegateUnbubbleEvents(),b.rendered=!0;e(b.init,[],b);c&&b.trigger("created",null,!0)});b.trigger("interact",{tmpl:a},!0);b.resume()};a?b.getTemplate(b.manage(function(a){b.template=a;c()})):c()},updateViewId:function(){this.id=p(this.vId)?
this.vId:this.vfId},setNodeHTML:function(b){p(this.id).innerHTML=b},setViewHTML:function(b){if(this.exist){var a=this.rendered;if(a){var c=d.config().viewChangeAnim&&this.enableRefreshAnim;this.trigger("refresh",null,!0,!0);this.trigger("prerender",{anim:c});this.destroyManaged(!0);this.undelegateUnBubbleEvents();this.destroyFrames();var f=this.owner;c&&(e(f.oldViewDestroy,[],f),e(f.prepareNextView,[],f),this.updateViewId())}else this.$bakHTML=p(this.id).innerHTML;this.setNodeHTML(b);c&&e(f.newViewCreated,
[],f);this.delegateUnbubbleEvents();this.rendered=!0;this.trigger("rendered");a||this.trigger("created",null,!0)}},postMessageTo:function(b,a){this.idle(this.owner.postMessageTo,[b,a],this.owner)},idle:function(b,a,c){var f=this;f.iC?f.iQ.push([b,a,c]):f.ownerVOM.idle(function(){f.exist&&d.isFunction(b)&&e(b,a,c)})},getLocation:function(){return this.ownerVOM.$location},observeLocation:function(b,a){var c=arguments;1==c.length&&(a=!1);if(c.length)this.$location={keys:d.isArray(b)?b:(""+b).split(","),
pn:a}},testOLChanged:function(b){var a=this.$location,b=b.changed;if(a){var c=!1;a.pn&&(c=b.isPathname());if(!c)for(var a=a.keys,e=0;e<a.length;e++)if(b.isParam(a[e])){c=!0;break}return c}return!0},destroyFrames:function(){for(var b=p(this.id).getElementsByTagName("iframe"),a,c;b.length;)a=b[0],c=a.parentNode,a.src="",c.removeChild(a);n.CollectGarbage&&n.CollectGarbage()},destroy:function(b){this.trigger("refresh",null,!0,!0);this.trigger("destroy",null,!0,!0);this.destroyManaged();this.undelegateUnBubbleEvents();
this.undelegateBubbleEvents();if(this.hasTemplate&&!b)this.destroyFrames(),p(this.vfId).innerHTML=this.$bakHTML||"";this.exist=!1;this.iQ=[];this.sign++},getTemplate:function(b){var a=this;if(a.template)b(a.template);else{var c=d.templates[a.viewName];if(c)b(c);else{var c=d.config(),e=c.appHome+a.viewName+".html";c.release||(e+="?_="+(new Date).getTime()+".html");a.getTmplByXHR(e,function(c){b(d.templates[a.viewName]=c)})}}},processEvent:function(b){if(this.enableEvent&&this.exist){for(var a=b.target;a&&
1!=a.nodeType;)a=a.parentNode;for(var c=a,f="mx"+b.type,d,i=p(this.vfId);c&&c!=i&&!(d=c.getAttribute(f));)c=c.parentNode;if(d)if(f=c.getAttribute("data-handler"))~[",",f,","].join().indexOf(","+this.vfId+",")||(d=0);else{for(f=c;f&&f!=i;)if("VFRAME"==f.tagName.toUpperCase()){c.setAttribute("data-handler",f.id);d=0;break}else f=f.parentNode;d&&c.setAttribute("data-handler",this.vfId)}if(d){d=d.split(":");var i=d.shift(),f=d[d.length-1],l,c=g.idIt(c);if("_halt_"==f||"_stop_"==f)b.stopPropagation(),
l=!0;if("_halt_"==f||"_prevent_"==f)b.preventDefault(),l=!0;l&&d.pop();l=this.events;for(var f=l[b.type],j=0,h;j<d.length;j++)h=d[j].lastIndexOf("@"),-1<h&&(d[d[j].substring(h+1)]=d[j].substring(0,h));f[i]&&e(f[i],{view:this,currentId:c,targetId:g.idIt(a),domEvent:b,events:l,params:d},f)}}},fixedEvent:function(b){if(!b)b=n.event;if(b){if(!b.stopPropagation)b.stopPropagation=function(){b.cancelBubble=!0};if(!b.preventDefault)b.preventDefault=function(){b.returnValue=!1};if(b.srcElement&&!b.target)b.target=
b.srcElement}return b},processDelegateEvents:function(b,a){var c=this;if(c.enableEvent){var e=c.events,d=p(c.vfId);if(c.$bubbleList&&c.$unbubbleList)for(var e=b?c.$bubbleList:c.$unbubbleList,g=0;g<e.length;g++)b?d["on"+e[g]]=a?null:function(b){b=c.fixedEvent(b);c.processEvent(b)}:a?c.undelegateUnbubble(d,e[g]):c.delegateUnbubble(d,e[g]);else for(g in c.$bubbleList=[],c.$unbubbleList=[],e)f(e,g)&&(f(x,g)?(c.$unbubbleList.push(g),b||(a?c.undelegateUnbubble(d,g):c.delegateUnbubble(d,g))):(c.$bubbleList.push(g),
b&&(d["on"+g]=a?null:function(b){b=c.fixedEvent(b);c.processEvent(b)})))}},delegateBubbleEvents:function(){this.processDelegateEvents(!0)},delegateUnbubbleEvents:function(){this.processDelegateEvents()},undelegateUnBubbleEvents:function(){this.processDelegateEvents(!1,!0)},undelegateBubbleEvents:function(){this.processDelegateEvents(!0,!0)},manage:function(a,c){var e=!0;1==arguments.length&&(c=a,a="res_"+b++,e=!1);if(!this.$resCache)this.$resCache={};e={hasKey:e,res:c};d.isFunction(c)&&(c=this.wrapManagedFunction(c),
e[this.sign]=c);this.$resCache[a]=e;return c},getManaged:function(b){var a=this.$resCache,c=this.sign;return a&&f(a,b)?(b=a[b],a=b.res,d.isFunction(a)&&(b[c]||(b[c]=this.wrapManagedFunction(a)),a=b[c]),a):null},removeManaged:function(b){var a=this.$resCache;if(a)if(f(a,b))delete a[b];else for(var c in a)if(a[c].res===b){delete a[c];break}},destroyManaged:function(b){var a=this.$resCache;if(a){for(var c in a){var f=a[c],g=!1,i=f.res;if(d.isNumber(i))n.clearTimeout(i),n.clearInterval(i),g=!0;else if(i)for(var l=
0;l<k.length;l++)d.isFunction(i[k[l]])&&(e(i[k[l]],[],i),g=!0);this.trigger("destroyResource",{resource:i,processed:g});b&&!f.hasKey&&delete a[c]}b||(this.unbind("destroyResource"),delete this.$resCache)}},wrapManagedFunction:function(b){var a=this,c=a.sign;return function(){a.sign==c&&e(b,arguments,a)}},beginAsyncUpdate:function(){return this.sign++},signature:function(){return this.sign},endAsyncUpdate:function(){return this.sign},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;
if(!this.iC){var b=[].slice.call(this.iQ);for(this.iQ=[];b.length;)this.idle.apply(this,b.shift())}}});d.mix(g,c,{prototype:!0});d.mix(g.prototype,c.prototype);return g},{requires:["magix/impl/view","magix/magix","magix/event"]});
KISSY.add("magix/vom",function(h,c,d){var a=document;return{iC:0,iQ:[],rootVframe:null,vframes:{},rootVframeId:"magix_vf_root",registerVframe:function(b){this.vframes[b.id]=b},getVframe:function(b){return this.vframes[b]},unregisterVframe:function(b){delete this.vframes[d.isString(b)?b:b.id]},buildRootVframe:function(){if(!this.rootVframe)a.getElementById(this.rootVframeId)||c.createVframeNode(this.rootVframeId,a.body.firstChild),this.rootVframe=c.createVframe(this.rootVframeId,{owner:this}),this.registerVframe(this.rootVframe)},
remountRootVframe:function(b){this.$location=b.location;this.buildRootVframe();this.rootVframe.mountView(b.location.viewPath)},notifyLocationChange:function(b){this.$location=b.location;this.rootVframe&&this.rootVframe.notifyLocationChange(b)},idle:function(b,a,c){this.iC?this.iQ.push([b,a,c]):d.safeExec(b,a,c)},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;if(!this.iC){var b=this.iQ;if(b.length){b=[].slice.call(b);for(this.iQ=[];b.length;)this.idle.apply(this,b.shift())}}}}},
{requires:["magix/vframe","magix/magix"]});
KISSY.add("mxext/model",function(h,c){var d=function(a){a&&this.set(a);this.id=h.guid("m");this.hasLocker=this.locker=!1};c.mix(d,{GET:"GET",POST:"POST",extend:function(a,b){var e=function(){e.superclass.constructor.apply(this,arguments);b&&c.safeExec(b,[],this)};c.mix(e,this,{prototype:!0});return h.extend(e,this,a)}});c.mix(d.prototype,{urlMap:{},sync:c.noop,parse:c.noop,getPostParams:function(){return this.getParams("POST")},getParams:function(a){var a=a?a.toUpperCase():d.GET,a=this["$"+a],b=[],
c;if(a)for(var f in a)if(c=a[f],h.isArray(c))for(var i=0;i<c.length;i++)b.push(f+"="+encodeURIComponent(c[i]));else b.push(f+"="+encodeURIComponent(c));return b.join("&")},setParamsIf:function(a,b){this.setParams(a,b,d.GET,!0)},setParams:function(a,b,c,f){c=c?c.toUpperCase():d.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[c]=!0;c="$"+c;this[c]||(this[c]={});if(h.isObject(a))for(var i in a){if(!f||!this[c][i])this[c][i]=a[i]}else if(a&&b&&(!f||!this[c][a]))this[c][a]=b},setPostParams:function(a,
b){this.setParams(a,b,d.POST)},setPostParamsIf:function(a,b){this.setParams(a,b,d.POST,!0)},reset:function(){var a=this.$keysCache;if(a){for(var b in a)c.hasProp(a,b)&&delete this["$"+b];delete this.$keysCache}a=this.$keys;b=this.$attrs;if(a){for(var e=0;e<a.length;e++)delete b[a[e]];delete this.$keys}},url:function(){var a=this.get("uri"),b;if(a){b=a.split(":");var c=this.urlMap;if(c)for(var f=0;f<b.length&&!(c=c[b[f]],void 0===c);f++)f==b.length-1&&(a=c)}else throw Error("model not set uri");return a},
get:function(a){var b=this.$attrs;return b?b[a]:null},set:function(a,b,c){if(!this.$attrs)this.$attrs={};if(c&&!this.$keys)this.$keys=[];if(h.isObject(a))for(var f in a)c&&this.$keys.push(f),this.$attrs[f]=a[f];else a&&(c&&this.$keys.push(a),this.$attrs[a]=b)},load:function(a){this.request(a)},save:function(a){this.request(a)},request:function(a){a||(a={});var b=a.success,c=a.error,f=this;if(!f.hasLocker||!f.locker)f.$abort=!1,f.locker=f.hasLocker,a.success=function(a){f.locker=!1;if(!f.$abort){if(a){var c=
f.parse(a);c&&(h.isArray(c)&&(c={list:c}),f.set(c,null,!0))}b&&b.apply(this,arguments)}},a.error=function(){f.locker=!1;f.$abort||c&&c.apply(this,arguments)},f.$trans=f.sync(f,a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},beginTransaction:function(){this.$bakAttrs=h.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs},lock:function(a){this.hasLocker=
!!a}});return d},{requires:["magix/magix"]});
KISSY.add("mxext/modelfactory",function(h,c){var d=function(b){this.$modelClass=b},a=function(b){if(b._wraped_)return b;var a=function(a){var e=a.success,d=this;d.get("updateIdent")?(a.success=function(){d.set("updateIdent",!1);d._after&&c.safeExec(d._after,d);e&&e.apply(a)},b.call(d,a)):e&&e.apply(a)};a._wraped_=!0;return a};c.mix(d,{mClsCache:{},create:function(b,a){if(!a)throw Error("Factory.create modelClass ungiven");var c=this.mClsCache;b||(b=h.guid());c[b]||(c[b]=new d(a));return c[b]}});c.mix(d.prototype,
{registerModels:function(b){c.isArray(b)||(b=[b]);for(var a=0,d;a<b.length;a++){d=b[a];if(!d.type)throw Error("model must own a type attribute");this[d.type]=d}},fetchModels:function(b,a,d,i){var g=this;if(!g.$modelsCache)g.$modelsCache={};if(!g.$modelsCacheKeys)g.$modelsCacheKeys={};var l=g.$modelsCache,j=g.$modelsCacheKeys;c.isArray(b)||(b=[b]);for(var h=b.length,q=0,r,s=[],v=[],w,t=function(b,k,m,n){q++;if(k)r=n||"fetch data error";else{w=!0;m.set("updateIdent",!1);s[b]=m;if((b=m._cacheKey)&&!c.hasProp(l,
b))l[m._cacheKey]=m,m._after&&c.safeExec(m._after,m);4==i&&a(m)}if((b=m._cacheKey)&&c.hasProp(j,b)){var p=j[b];delete j[b];c.safeExec(p,[k,m,n],m)}4!=i&&q>=h&&(2==i?w?a&&a.apply(g,s):d&&d(r):r?d&&d(r):a&&a.apply(g,s))},x=Array.prototype.slice,u=function(b,a){var c=x.call(arguments,2);return function(){return b.apply(a,c.concat(x.call(arguments)))}},n=0,k;n<b.length;n++){k=b[n];var p=k.cacheKey;p&&c.hasProp(j,p)?j[p].push(u(t,g,n)):(k=g.create(k,!0),k.get("updateIdent")?(v.push(k),p&&(j[p]=[]),k.request({success:u(t,
k,n,!1,k),error:u(t,k,n,!0,k)})):t(n,!1,k))}return{abort:function(){for(var b=0,a;b<v.length;b++){a=v[b];var e=a._cacheKey;if(e&&c.hasProp(j,e)){var d=j[e];delete j[e];c.safeExec(d,[!0,a,"abort"],a)}a.abort()}}}},fetchAll:function(b,a,c){return this.fetchModels(b,a,c,1)},fetchAny:function(b,a,c){return this.fetchModels(b,a,c,2)},fetchOne:function(b,a){return this.fetchModels(b,a,c.noop,4)},getIf:function(b){var a=this.$modelsCache;return a&&c.hasProp(a,b)?a[b]:null},setUpdateIdent:function(b){(b=
this.getIf(b))&&b.set("updateIdent",!0)},create:function(b,e){if(!b.type)throw Error('model must own a "type" attribute');var d=b.type,i=b.cacheKey||d.cacheKey,g;if(!this.$modelsCache)this.$modelsCache={};var l=this.$modelsCache;if(i&&c.hasProp(l,i)){g=l[i];var j=g.get("updateIdent");j&&delete l[i]}else g=new this.$modelClass(d.ops),g._after=d.after,g._cacheKey=i,g.set("updateIdent",!0);if(j=g.get("updateIdent"))g.reset(),g.set(b.ops),g.setParams(d.gets),g.setPostParams(d.posts),g.setParams(b.gets),
g.setPostParams(b.posts),c.isFunction(d.before)&&c.safeExec(d.before,g,d);if(!e)g.request=a(g.request);return g}});return d},{requires:["magix/magix"]});
KISSY.add("mxext/mu",function(h,c){function d(b,c){var e=/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/i,d=b.match(/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/ig),j=[];if(d)for(var h=0;h<d.length;h++)j.push(d[h].match(e)[1]);e="";for(d=0;d<j.length;d++)e="if("+j[d]+")",c[e]||(c[e]=a(j[d]))}function a(b){b=b.split("==");return function(){for(var a=b[0].split("."),c=b[1],e=a.length-1;-1<e;e--){var d=a.slice(e),h=this;try{for(var q=0;q<d.length-1;q++)h=h[d[q]];if(d[d.length-1]in h){if(h[d[d.length-1]].toString()===c)return!0;
break}}catch(r){}}return!1}}function b(a,c){var d,e;for(d in a)if(e=a[d],e instanceof Array)for(var h=0;h<e.length;h++){var o=e[h];if("object"==typeof o)0===h?o.__first__=!0:h==e.length-1?o.__last__=!0:o.__mid__=!0,o.__index__=h}else"object"==typeof e&&5>c&&b(e,c+1)}var e=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/tmpl\1[^>]*>([\s\S]*?)<\/script>\s*/gi;return{to_html:function(a,i){"object"==typeof i&&b(i,0);var g=a.match(e);if(g){a=a.replace(e,function(){return'<script type="text/tmpl"><\/script>'});
d(a,i);var a=c.to_html.apply(this,arguments),h=0,a=a.replace(e,function(){return g[h++]})}else d(a,i),a=c.to_html.apply(this,arguments);return a}}},{requires:["mxext/mustache"]});
KISSY.add("mxext/mustache",function(){return function(){var h=function(){};h.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(c,d,a,b){if(!b)this.context=d,this.buffer=[];if(this.includes("",c)){c=this.render_pragmas(c);c=this.render_section(c,d,a);if(b)return this.render_tags(c,d,a,b);this.render_tags(c,d,a,b)}else{if(b)return c;this.send(c)}},send:function(c){""!=c&&this.buffer.push(c)},render_pragmas:function(c){if(!this.includes("%",
c))return c;var d=this;return c.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(a,b,c){if(!d.pragmas_implemented[b])throw{message:"This implementation of mustache doesn't understand the '"+b+"' pragma"};d.pragmas[b]={};c&&(a=c.split("="),d.pragmas[b][a[0]]=a[1]);return""})},render_partial:function(c,d,a){c=this.trim(c);if(!a||void 0===a[c])throw{message:"unknown_partial '"+c+"'"};return"object"!=typeof d[c]?this.render(a[c],d,a,!0):this.render(a[c],d[c],a,!0)},render_section:function(c,
d,a){if(!this.includes("#",c)&&!this.includes("^",c))return c;var b=this;return c.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(c,f,i,g){c=b.find(i,d);if("^"==f)return!c||b.is_array(c)&&0===c.length?b.render(g,d,a,!0):"";if("#"==f)return b.is_array(c)?b.map(c,function(c){return b.render(g,b.create_context(c),a,!0)}).join(""):b.is_object(c)?b.render(g,b.create_context(c),a,!0):"function"===typeof c?c.call(d,g,
function(c){return b.render(c,d,a,!0)}):c?b.render(g,d,a,!0):""})},render_tags:function(c,d,a,b){for(var e=this,f=function(){return RegExp(e.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+e.ctag+"+","g")},i=f(),g=function(b,c,g){switch(c){case "!":return"";case "=":return e.set_delimiters(g),i=f(),"";case ">":return e.render_partial(g,d,a);case "{":return e.find(g,d);default:return e.escape(e.find(g,d))}},c=c.split("\n"),h=0;h<c.length;h++)c[h]=c[h].replace(i,g,this),b||this.send(c[h]);if(b)return c.join("\n")},
set_delimiters:function(c){c=c.split(" ");this.otag=this.escape_regex(c[0]);this.ctag=this.escape_regex(c[1])},escape_regex:function(c){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return c.replace(arguments.callee.sRE,"\\$1")},find:function(c,d){var c=this.trim(c),a;!1===d[c]||0===d[c]||d[c]?a=d[c]:(!1===this.context[c]||0===this.context[c]||this.context[c])&&(a=this.context[c]);return"function"===typeof a?a.apply(d):void 0!==
a?a:""},includes:function(c,d){return-1!=d.indexOf(this.otag+c)},escape:function(c){return(""+(null===c?"":c)).replace(/&(?!\w+;)|["'<>\\]/g,function(c){switch(c){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return c}})},create_context:function(c){if(this.is_object(c))return c;var d=".";if(this.pragmas["IMPLICIT-ITERATOR"])d=this.pragmas["IMPLICIT-ITERATOR"].iterator;var a={};a[d]=c;return a},is_object:function(c){return c&&
"object"==typeof c},is_array:function(c){return"[object Array]"===Object.prototype.toString.call(c)},trim:function(c){return c.replace(/^\s*|\s*$/g,"")},map:function(c,d){if("function"==typeof c.map)return c.map(d);for(var a=[],b=c.length,e=0;e<b;e++)a.push(d(c[e]));return a}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(c,d,a,b){var e=new h;if(b)e.send=b;e.render(c,d,a);if(!b)return e.buffer.join("\n")}}}()});
KISSY.add("mxext/tmpl",function(){var h={},c={},d="_"+(new Date).getTime(),a=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/tmpl\1[^>]*>([\s\S]*?)<\/script>\s*/gi,b=function(a,b){if(a){var i;i=c[a];i||(i=d+".push('"+a.replace(/\s+/g," ").replace(/<#/g,"\r").replace(/;*#>/g,"\n").replace(/\\(?=[^\r\n]*\n)/g,"\t").replace(/\\/g,"\\\\").replace(/\t/g,"\\").replace(/'(?=[^\r\n]*\n)/g,"\t").replace(/'/g,"\\'").replace(/\t/g,"'").replace(/\r=([^\n]+)\n/g,"',$1,'").replace(/\r/g,"');").replace(/\n/g,";"+d+".push('")+
"');return "+d+".join('')",c[a]=i);var g=[d],l=[[]],j;if(b)for(j in b)g.push(j.replace(/[:+\-*\/&^%#@!~]/g,"$")),l.push(b[j]);j=g.join("_")+"_"+i;if(!h[j])try{h[j]=new Function(g,i)}catch(o){return o.message}try{i=h[j].apply(b,l)}catch(q){i=q.message}return i}return a};return{toHTML:function(c,d){var h=c.match(a);if(h)var c=c.replace(a,function(){return'<script type="text/tmpl"><\/script>'}),c=b(c,d),g=0,c=c.replace(a,function(){return h[g++]});else c=b(c,d);return c}}});
KISSY.add("mxext/vfanim",function(h,c,d){var a=d.config(),b=document,e=a.viewChange,f=d.isFunction(e),i=function(a){return"object"==typeof a?a:b.getElementById(a)};return d.mix(c.prototype,{viewChangeUseAnim:function(){return a.viewChangeAnim},oldViewDestroy:function(){var a=i(this.id),c=i(this.viewId),e=this.view;if(!c){for(c=b.createElement("div");a.firstChild;)c.appendChild(a.firstChild);a.appendChild(c)}c.id="";if(a=e.events)for(var f in a)d.hasProp(a,f)&&h.all("*[mx"+f+"]").removeAttr("mx"+f);
if(!d.hasProp(this,"$animCounter"))this.$animCounter=0;this.$animCounter++;this.$oldViewNode=c},prepareNextView:function(){var a=i(this.id),c=b.createElement("div");c.id=this.viewId;a.insertBefore(c,a.firstChild)},newViewCreated:function(a){var b=this,c=b.$oldViewNode,h=i(b.viewId);f&&d.safeExec(e,{vframeId:b.id,action:a?"viewChange":"viewRefresh",oldViewNode:c,newViewNode:h,collectGarbage:function(){b.$animCounter--;b.$animCounter||delete b.$oldViewNode;try{c.parentNode.removeChild(c)}catch(a){}}},
b)}})},{requires:["magix/vframe","magix/magix","sizzle"]});
KISSY.add("mxext/view",function(h,c,d){return c.extend({queryEvents:null,navigate:function(a){d.navigate(a)},attachQueryEvents:function(){var a=this,b=a.queryEvents;if(b){a.$queryEventsCache={};for(var d in b){var f=b[d],i;for(i in f)h.all("#"+a.id+" "+i).on(d,a.$queryEventsCache[d+"_"+i]=function(d){return function(e){var f=c.idIt(e.target),h=c.idIt(e.currentTarget);Magix.safeExec(d,{view:a,targetId:f,currentId:h,queryEvents:b,domEvent:e},b)}}(f[i]))}}},detachQueryEvents:function(){var a=this.queryEvents;
if(a){for(var b in a){var c=a[b],d;for(d in c)h.all("#"+this.id+" "+d).detach(b,this.$queryEventsCache[b+"_"+d])}delete this.$queryEventsCache}},setData:function(a){this.data=a;for(var b in a)a[b]&&a[b].toJSON&&(a[b]=a[b].toJSON());this.setRenderer()},setRenderer:function(){var a=this,b=this.renderer,c,d;if(b)for(c in b)for(d in b[c])(function(){var h=c,g=d,l=b[h][g];a.data[h+"_"+g]=function(){return l.call(this,a,h)}})()}},function(){var a=this;a.bind("created",function(){a.attachQueryEvents();a.bind("prerender",
function(){a.detachQueryEvents()});a.bind("rendered",function(){a.attachQueryEvents()})})})},{requires:["magix/view","magix/router"]});(function(h){var c=function(){};if(!h.console)h.console={log:c,warn:c,error:c,debug:c};if(!h.Magix)h.Magix={start:function(c){this.$tempCfg=c}},KISSY.use("magix/magix",function(c,a){var b=h.Magix.$tempCfg;h.Magix=a;b&&a.start(b)})})(this);